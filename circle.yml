machine:
  services:
    - docker
  environment:
    COVALENCE_VERSION: 0.6.0
    ATLAS_TOKEN: GryCCpG3GRBqQw.atlasv1.1ASD0jMKyVmLmUVlqP7ca6xdxqzY1nNroAVtTSKRBYR7fnLxciPCboidfwKR6bXBaWQ
    RUBY_TAG: 2.3.4
    TERRAFORM_TAG: 0.10.6

test:
  pre:
    - docker pull ruby:$RUBY_TAG
  override:
    - |
      docker run -v /home/ubuntu/covalence:/data \
                 -w /data \
                 --entrypoint=/bin/sh \
                 ruby:$RUBY_TAG -c " \
                 apt-get update && \
                 apt-get install -y unzip && \
                 wget -q \"https://releases.hashicorp.com/terraform/${TERRAFORM_TAG}/terraform_${TERRAFORM_TAG}_linux_amd64.zip\" && \
                 unzip -d /usr/local/bin terraform_${TERRAFORM_TAG}_linux_amd64.zip && \
                 bundle install && \
                 bundle exec rake ci:covalence"

    - gem build covalence.gemspec

general:
  artifacts:
    - covalence-${COVALENCE_VERSION}.gem
